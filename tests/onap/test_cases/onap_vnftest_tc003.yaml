##############################################################################
# Copyright 2018 EuropeanSoftwareMarketingLtd.
# ===================================================================
#  Licensed under the ApacheLicense, Version2.0 (the"License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#  http://www.apache.org/licenses/LICENSE-2.0
#
# software distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and limitations under
# the License
##############################################################################

---
schema: "vnftest:task:0.1"
description: >
    Vnftest TC003 config file;
    Delete VF module

{% set service_instance_id = service_instance_id or '\"\u007Bservice_instance_id\u007D\"' %}
{% set vnf_instance_id = vnf_instance_id or '\"\u007Bvnf_instance_id\u007D\"' %}
{% set vf_module_instance_id = vf_module_instance_id or '\"\u007Bvf_module_instance_id\u007D\"' %}
{% set vnf_type = vnf_type or '\"\u007Bvnf_type\u007D\"' %}
{% set module_model_invariant_id = module_model_invariant_id or '\"\u007Bmodule_model_invariant_id\u007D\"' %}
{% set module_model_version_id = module_model_version_id or '\"\u007Bmodule_model_version_id\u007D\"' %}
{% set module_model_version = module_model_version or '\"\u007Bmodule_model_version\u007D\"' %}
{% set service_model_customization_id = service_model_customization_id or '\"\u007Bservice_model_customization_id\u007D\"' %}

steps:
-
  type: OnapApiCall
  options:
    file: "lifecycle/delete_vf_module.yaml"
    input:
    -
      parameter_name: "service_instance_id"
      value: {{service_instance_id}}
    -
      parameter_name: "vnf_instance_id"
      value: {{vnf_instance_id}}
    -
      parameter_name: "vf_module_instance_id"
      value: {{vf_module_instance_id}}
    -
      parameter_name: "module_model_invariant_id"
      value: {{module_model_invariant_id}}
    -
      parameter_name: "module_model_version_id"
      value: {{module_model_version_id}}
    -
      parameter_name: "vnf_type"
      value: {{vnf_type}}
    -
      parameter_name: "module_model_version"
      value: {{module_model_version}}
    -
      parameter_name: "service_model_customization_id"
      value: {{service_model_customization_id}}
    -
      parameter_name: "tenant_id"
      value: "{context|creds|tenant_id}"
    
    output:
    -
      parameter_name: "request_id"
      value: "[requestReferences][requestId]"
  runner:
    type: Iteration
    run_step: "setup,run"

-
  type: OnapApiCall
  options:
    file: "lifecycle/monitor_request.yaml"
    input:
    -
      parameter_name: "request_id"
      value: "{request_id}"
    output:
    -
      parameter_name: "request_state"
      value: "[request][requestStatus][requestState]"
  sla:
    action: assert
    value: "{request_state}"
    equals: "COMPLETE"
    retries: 15
    interval: 5

  runner:
    type: Iteration
    run_step: "setup,run"

context:
  type: CSAR